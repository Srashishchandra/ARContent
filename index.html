<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Business Card Viewer</title>
    <!-- AR.js libraries -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        #ar-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a2a6c, #2a3c7f, #4a5f9a);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ff9966;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        .instructions {
            position: fixed;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            z-index: 100;
            padding: 0 20px;
        }
        
        .instruction-box {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 20px;
            max-width: 500px;
            margin: 0 auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .instruction-box h3 {
            margin-bottom: 10px;
            color: #ff9966;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .instruction-box ol {
            text-align: left;
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .instruction-box li {
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            background: linear-gradient(to right, #ff9966, #ff5e62);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button.secondary {
            background: linear-gradient(to right, #36d1dc, #5b86e5);
        }
        
        .status {
            position: fixed;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            z-index: 100;
            padding: 0 20px;
        }
        
        .status-message {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            display: inline-block;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            max-width: 500px;
        }
        
        .error {
            background: rgba(231, 76, 60, 0.9);
        }
        
        .success {
            background: rgba(46, 204, 113, 0.9);
        }
        
        .content-info {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            color: white;
            padding: 15px;
            border-radius: 15px;
            max-width: 300px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
        }
        
        .content-info h3 {
            color: #ff9966;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-item {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-label {
            font-weight: bold;
            min-width: 70px;
        }
        
        @media (max-width: 768px) {
            .instruction-box {
                margin: 0 15px;
            }
            
            .content-info {
                position: relative;
                top: auto;
                right: auto;
                max-width: 90%;
                margin: 20px auto;
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
        <div class="loading-text" id="loadingText">Initializing AR Camera...</div>
    </div>
    
    <!-- Status Message -->
    <div class="status" id="statusContainer">
        <div class="status-message" id="statusMessage">Preparing AR Experience</div>
    </div>
    
    <!-- Content Information -->
    <div class="content-info" id="contentInfo">
        <h3><i class="fas fa-id-card"></i> Business Card</h3>
        <div class="info-item">
            <span class="info-label">Name:</span>
            <span id="infoName">Alex Johnson</span>
        </div>
        <div class="info-item">
            <span class="info-label">Title:</span>
            <span id="infoTitle">Senior Developer</span>
        </div>
        <div class="info-item">
            <span class="info-label">Company:</span>
            <span id="infoCompany">Tech Innovations Inc.</span>
        </div>
        <div class="info-item">
            <span class="info-label">Email:</span>
            <span id="infoEmail">alex@techinnovations.com</span>
        </div>
    </div>
    
    <!-- Instructions -->
    <div class="instructions">
        <div class="instruction-box">
            <h3><i class="fas fa-info-circle"></i> How to View AR Content</h3>
            <ol>
                <li>Point your camera at a flat surface</li>
                <li>Move your device slowly to detect surfaces</li>
                <li>Tap on the detected surface to place the 3D model</li>
                <li>Move around to view the model from different angles</li>
            </ol>
            <div class="controls">
                <button id="toggleInfo">
                    <i class="fas fa-info-circle"></i> Toggle Info
                </button>
                <button id="recenter" class="secondary">
                    <i class="fas fa-crosshairs"></i> Recenter
                </button>
            </div>
        </div>
    </div>
    
    <!-- AR Container -->
    <div id="ar-container">
        <!-- AR Scene will be inserted here -->
    </div>
    
    <!-- Font Awesome for icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    
    <script>
        // DOM Elements
        const loadingScreen = document.getElementById('loadingScreen');
        const loadingText = document.getElementById('loadingText');
        const statusContainer = document.getElementById('statusContainer');
        const statusMessage = document.getElementById('statusMessage');
        const contentInfo = document.getElementById('contentInfo');
        const toggleInfoBtn = document.getElementById('toggleInfo');
        const recenterBtn = document.getElementById('recenter');
        const arContainer = document.getElementById('ar-container');
        
        // Business card data
        const businessCard = {
            name: "Alex Johnson",
            title: "Senior Developer",
            company: "Tech Innovations Inc.",
            email: "alex.johnson@techinnovations.com",
            phone: "+1 (555) 123-4567",
            website: "www.techinnovations.com",
            modelUrl: "https://static.wixstatic.com/3d/018211_a1f37957ac474262afc8e515acd8e705.glb"
        };
        
        // Update status message
        function updateStatus(message, type = '') {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message';
            if (type) {
                statusMessage.classList.add(type);
            }
            statusContainer.style.display = 'block';
            
            // Auto-hide success messages after 3 seconds
            if (type === 'success') {
                setTimeout(() => {
                    statusContainer.style.display = 'none';
                }, 3000);
            }
        }
        
        // Update content info
        function updateContentInfo() {
            document.getElementById('infoName').textContent = businessCard.name;
            document.getElementById('infoTitle').textContent = businessCard.title;
            document.getElementById('infoCompany').textContent = businessCard.company;
            document.getElementById('infoEmail').textContent = businessCard.email;
        }
        
        // Create AR scene
        function createARScene() {
            // Create the scene element
            const scene = document.createElement('a-scene');
            scene.setAttribute('embedded', '');
            scene.setAttribute('vr-mode-ui', 'enabled: false');
            scene.setAttribute('renderer', 'logarithmicDepthBuffer: true; precision: high;');
            scene.setAttribute('arjs', 'sourceType: webcam; videoTexture: true; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;');
            
            // Create marker
            const marker = document.createElement('a-marker');
            marker.setAttribute('type', 'barcode');
            marker.setAttribute('value', '123'); // Using barcode marker for simplicity
            
            // Create the 3D model
            const model = document.createElement('a-entity');
            model.setAttribute('gltf-model', businessCard.modelUrl);
            model.setAttribute('scale', '0.8 0.8 0.8');
            model.setAttribute('position', '0 0.5 0');
            model.setAttribute('rotation', '0 0 0');
            model.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear');
            
            // Add model to marker
            marker.appendChild(model);
            
            // Add marker to scene
            scene.appendChild(marker);
            
            // Add camera
            const camera = document.createElement('a-entity');
            camera.setAttribute('camera', '');
            camera.setAttribute('position', '0 0 0');
            scene.appendChild(camera);
            
            // Add lights
            const light1 = document.createElement('a-entity');
            light1.setAttribute('light', 'type: directional; color: #FFF; intensity: 0.6; castShadow: true');
            light1.setAttribute('position', '-1 2 1');
            scene.appendChild(light1);
            
            const light2 = document.createElement('a-entity');
            light2.setAttribute('light', 'type: ambient; color: #FFF; intensity: 0.4');
            scene.appendChild(light2);
            
            // Add tap-to-place functionality for markerless AR
            const tapPlace = document.createElement('a-entity');
            tapPlace.setAttribute('cursor', 'rayOrigin: mouse');
            tapPlace.setAttribute('id', 'cursor');
            scene.appendChild(tapPlace);
            
            // Insert scene into container
            arContainer.appendChild(scene);
            
            return scene;
        }
        
        // Initialize AR experience
        async function initAR() {
            updateStatus("Requesting camera access...");
            loadingText.textContent = "Requesting camera access...";
            
            try {
                // First, check if we can access the camera
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: { ideal: 'environment' },
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                
                // Stop the stream - AR.js will start its own
                stream.getTracks().forEach(track => track.stop());
                
                updateStatus("Camera access granted. Loading AR...");
                loadingText.textContent = "Camera access granted. Loading AR...";
                
                // Create AR scene
                const scene = createARScene();
                
                // Update content info
                updateContentInfo();
                
                // When scene is loaded
                scene.addEventListener('loaded', function() {
                    setTimeout(() => {
                        updateStatus("AR scene loaded! Point camera at a flat surface.", "success");
                        loadingScreen.classList.add('hidden');
                        
                        // Show instructions for a few seconds
                        setTimeout(() => {
                            const instructionBox = document.querySelector('.instruction-box');
                            instructionBox.style.opacity = '0.8';
                            instructionBox.style.transition = 'opacity 2s';
                            
                            setTimeout(() => {
                                instructionBox.style.opacity = '0.3';
                            }, 5000);
                        }, 1000);
                    }, 1000);
                });
                
                // Handle errors
                scene.addEventListener('error', function(error) {
                    console.error('AR scene error:', error);
                    updateStatus("Error loading AR scene. Please refresh the page.", "error");
                });
                
            } catch (error) {
                console.error('Camera access error:', error);
                
                if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                    updateStatus("Camera access denied. Please allow camera access to use AR.", "error");
                    loadingText.textContent = "Camera access denied. Please allow camera access and refresh.";
                } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
                    updateStatus("No camera found on your device.", "error");
                    loadingText.textContent = "No camera found on your device.";
                } else {
                    updateStatus("Error accessing camera: " + error.message, "error");
                    loadingText.textContent = "Error accessing camera. Please try again.";
                }
                
                // Hide loading screen after error
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                }, 3000);
            }
        }
        
        // Event Listeners
        toggleInfoBtn.addEventListener('click', function() {
            if (contentInfo.style.display === 'block') {
                contentInfo.style.display = 'none';
            } else {
                contentInfo.style.display = 'block';
            }
        });
        
        recenterBtn.addEventListener('click', function() {
            const scene = document.querySelector('a-scene');
            if (scene) {
                // Find the marker and reset its position
                const marker = scene.querySelector('a-marker');
                if (marker) {
                    marker.setAttribute('position', '0 0 0');
                }
                updateStatus("Model recentered", "success");
            }
        });
        
        // Handle visibility change
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // Page is hidden, pause AR
                const scene = document.querySelector('a-scene');
                if (scene) {
                    scene.pause();
                }
            } else {
                // Page is visible, resume AR
                const scene = document.querySelector('a-scene');
                if (scene) {
                    scene.play();
                }
            }
        });
        
        // Initialize when page loads
        window.addEventListener('load', function() {
            // Check if browser supports required features
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                updateStatus("Your browser doesn't support camera access. Please try Chrome or Safari on mobile.", "error");
                loadingText.textContent = "Browser not supported";
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                }, 3000);
                return;
            }
            
            // Start AR experience
            initAR();
        });
        
        // Handle mobile device orientation
        window.addEventListener('deviceorientation', function() {
            // This helps with mobile AR stability
        }, true);
    </script>
</body>
</html>
